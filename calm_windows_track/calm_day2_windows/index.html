<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-calm_windows_track/calm_day2_windows/calm_day2_windows">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Calm: Day 2 Operations | Calm 301</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/ncm301/calm_windows_track/calm_day2_windows/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Calm: Day 2 Operations | Calm 301"><meta data-rh="true" name="description" content="In the calm_linux{.interpreted-text role=&quot;ref&quot;} and"><meta data-rh="true" property="og:description" content="In the calm_linux{.interpreted-text role=&quot;ref&quot;} and"><link data-rh="true" rel="icon" href="/ncm301/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/ncm301/calm_windows_track/calm_day2_windows/"><link data-rh="true" rel="alternate" href="https://github.com/ncm301/calm_windows_track/calm_day2_windows/" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/ncm301/calm_windows_track/calm_day2_windows/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ncm301/blog/rss.xml" title="Calm 301 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ncm301/blog/atom.xml" title="Calm 301 Atom Feed"><link rel="stylesheet" href="/ncm301/assets/css/styles.70a3dea8.css">
<link rel="preload" href="/ncm301/assets/js/runtime~main.78c31634.js" as="script">
<link rel="preload" href="/ncm301/assets/js/main.2f042511.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ncm301/"><div class="navbar__logo"><img src="/ncm301/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ncm301/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/ncm301/">NCM Self Service Bootcamp</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mat0606/ncm301" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><h1>Overview</h1><p>In the <code>calm_linux</code>{.interpreted-text role=&quot;ref&quot;} and
<code>calm_win</code>{.interpreted-text role=&quot;ref&quot;} labs you explored how Calm can
be used to model and deploy complex applications using a blueprint.
Calm, however, it capable of managing applications throughout their
<strong>entire</strong> lifecycle.</p><p><strong>In this lab you will implement custom actions within Calm to address
\&quot;Day 2\&quot; operations, including scaling out, scaling in, and upgrading
your application.</strong></p><h1>Lab Setup</h1><p>This lab depends on the availability of a multi-tier <strong>Task Manger</strong> web
application implemented during the <code>calm_linux</code>{.interpreted-text
role=&quot;ref&quot;} lab.</p><h1>Scaling Out</h1><p>Imagine you\&#x27;re the administrator of the Task Manager application that
we\&#x27;ve been building, and you\&#x27;re currently unsure of the amount of
demand for this application by your end users. Or, potentially, you
expect the demand to ebb and flow due to the time of the year. How can
we easily scale to meet this changing demand?</p><p>During the creation of the Task Manager blueprint, the <strong>WebServer</strong>
service was configured with a minimum number of 2 replicas, with a
maximum of 4. As a result, Calm will create 2 WebServer VMs during the
initial deployment. In the event the 2 replicas are not enough to handle
the load of your end users, a <strong>Scale Out</strong> operation is required.</p><ol><li><p>In the <strong>Application Overview <!-- -->&gt;<!-- --> Application Profile</strong> section,
expand the <strong>Default</strong> Application Profile.</p><p><img loading="lazy" src="/ncm301/assets/images/510scaleout0-5819c0e9eae5abb453451bc839a2d4a0.png" width="234" height="434" class="img_ev3q"></p></li><li><p>Select <code>plus-circle</code>{.interpreted-text role=&quot;fa&quot;} next to
<strong>Actions</strong> to add a new, custom action. On the <strong>Configuration
Pane</strong> to the right, rename the new Action to be <strong>Scale Out</strong>.</p><p><img loading="lazy" src="/ncm301/assets/images/510scaleout1-15e5a7d468ab43948d83c6e0f63dba01.png" width="785" height="451" class="img_ev3q"></p></li><li><p>In the box <strong>below</strong> the <strong>WebServer</strong> service tile, click the <strong>+
Task</strong> button to add a scaling task, and fill out the following
fields:</p><ul><li><strong>Task Name</strong> - web_scale_out</li><li><strong>Scaling Type</strong> - Scale Out</li><li><strong>Scaling Count</strong> - 1</li></ul><p><img loading="lazy" src="/ncm301/assets/images/510scaleout2-982570ea6d9e6eca9350c7b80ea0ef65.png" width="337" height="277" class="img_ev3q"></p><p>::: note
::: title
Note
:::</p><p>The <strong>+ Task</strong> button that appears below the service tile is only
used for scaling the number of replicas up and down, so it is
important to select the correct option.
:::</p><p>When a user later runs the <strong>Scale Out</strong> task, a new <strong>WebServer</strong>
VM will get created, and the <strong>Package Install</strong> tasks for that
service will be executed. However, we do need to modify the
<strong>HAProxy</strong> configuration in order to start taking advantage of this
new web server.</p></li><li><p><strong>Within</strong> the <strong>HAProxy</strong> service tile, click the <strong>+ Task</strong>
button, then fill out the following fields:</p><ul><li><strong>Task Name</strong> - add_webserver</li><li><strong>Type</strong> - Execute</li><li><strong>Script Type</strong> - Shell</li><li><strong>Credential</strong> - CENTOS</li></ul></li><li><p>Copy and paste the following script into the <strong>Script</strong> field:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;@@{WebServer.address}@@&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;,&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; server host-</span><span class="token string variable" style="color:#36acaa">${host}</span><span class="token string" style="color:#e3116c"> </span><span class="token string variable" style="color:#36acaa">${host}</span><span class="token string" style="color:#e3116c">:</span><span class="token string variable" style="color:#36acaa">${port}</span><span class="token string" style="color:#e3116c"> weight 1 maxconn 100 check&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> -a /etc/haproxy/haproxy.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart haproxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script will parse the last IP address in the WebServer address
array and append it to the haproxy.cfg file. However, we want to be
sure that this doesn\&#x27;t happen until <strong>after</strong> the new WebServer is
fully up, otherwise the HAProxy server may send requests to a
non-functioning WebServer.</p></li><li><p>To solve this issue, create an edge to force a dependency on the
<strong>web_scale_out</strong> task completing prior to the <strong>add_webserver</strong>
task.</p><p>Your <strong>Workspace</strong> should now look like this:</p><p><img loading="lazy" src="/ncm301/assets/images/510scaleout3-e4229c8d91c61797a9def9df429af23f.png" width="818" height="486" class="img_ev3q"></p></li></ol><h1>Scaling In</h1><p>It\&#x27;s the end of your busy season, and you\&#x27;d like to optimize your
resource utilization by scaling back the number of deployed Web Servers.</p><ol><li><p>Select <code>plus-circle</code>{.interpreted-text role=&quot;fa&quot;} to add a custom
action named <strong>Scale In</strong> to the Default <strong>Application Profile</strong>.</p><p><img loading="lazy" src="/ncm301/assets/images/510scalein1-fee39c559799ac0b8bbcfa6524412c72.png" width="783" height="488" class="img_ev3q"></p></li><li><p><strong>Below</strong> the <strong>WebServer</strong> service tile, click the <strong>+ Task</strong>
button to add a scaling task, and fill out the following fields:</p><ul><li><strong>Task Name</strong> - web_scale_in</li><li><strong>Scaling Type</strong> - Scale In</li><li><strong>Scaling Count</strong> - 1</li></ul><p><img loading="lazy" src="/ncm301/assets/images/510scalein2-d4f9fd55fbd1283d14cf3e7ed7318d3d.png" width="338" height="277" class="img_ev3q"></p><p>When a user later runs the <strong>Scale In</strong> task, the last <strong>WebServer</strong>
replica will have its <strong>Package Uninstall</strong> task run, the VM will be
shut down, and then deleted, which will reclaim resources. However,
we do need to modify the <strong>HAProxy</strong> configuration to ensure that
we\&#x27;re no longer sending traffic to the to-be-deleted Web Server.</p></li><li><p><strong>Within</strong> the <strong>HAProxy</strong> service tile, click the <strong>+ Task</strong>
button, then fill out the following fields:</p><ul><li><strong>Task Name</strong> - del_webserver</li><li><strong>Type</strong> - Execute</li><li><strong>Script Type</strong> - Shell</li><li><strong>Credential</strong> - CENTOS</li></ul></li><li><p>Copy and paste the following script into the <strong>Script</strong> field:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&quot;@@{WebServer.address}@@&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;,&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&quot;/</span><span class="token string variable" style="color:#36acaa">$host</span><span class="token string" style="color:#e3116c">/d&quot;</span><span class="token plain"> /etc/haproxy/haproxy.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart haproxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similar to the scale out script, this script will parse the last IP
in the WebServer address array and use the
<a href="http://www.grymoire.com/Unix/Sed.html" target="_blank" rel="noopener noreferrer">sed</a> command to remove the
corresponding entry from haproxy.cfg.</p><p>Again, similar to the scale out script, we want to ensure requests
stop being sent to the VM <strong>before</strong> it is removed.</p></li><li><p>To solve this issue, create an edge to force a dependency on the
<strong>del_webserver</strong> task completing prior to the <strong>web_scale_in</strong>
task.</p><p>Your <strong>Workspace</strong> should now look like this:</p><p><img loading="lazy" src="/ncm301/assets/images/510scalein3-f8bb90607df2e9cb1f5481b0b248e360.png" width="806" height="519" class="img_ev3q"></p></li><li><p>Click <strong>Save</strong> and ensure no errors or warnings pop-up. If they do,
resolve the issue, and <strong>Save</strong> again.</p></li></ol><h1>Upgrading</h1><p>Your company has a mandate to keep all application code up to date, to
help minimize security vulnerabilities. Your company also has a strict
change control process, meaning you can only update your application
during the weekend. You currently spend a significant portion of your
time on one Saturday every month completing application update
procedures during a maintenance window. Let\&#x27;s look at how you can
reclaim your weekend by modeling the application upgrade with Calm.</p><ol><li><p>Select <code>plus-circle</code>{.interpreted-text role=&quot;fa&quot;} to add a custom
action named <strong>Upgrade</strong> to the Default <strong>Application Profile</strong>.</p><p>The first thing we\&#x27;re going to need to do is to stop the respective
processes on each of our Services.</p></li><li><p><strong>Within each</strong> of our 3 Services, click the <strong>+ Task</strong> button to
add a new task, and fill in the following information:</p><hr><p>  <strong>Service Name</strong>   MySQL       WebServer       HAProxy</p><p>  <strong>Task Name</strong>      StopMySQL   StopWebServer   StopHAProxy</p><p>  <strong>Type</strong>           Execute     Execute         Execute</p><p>  <strong>Script Type</strong>    Shell       Shell           Shell</p><p>  <strong>Credential</strong>     CENTOS      CENTOS          CENTOS</p><p>  <strong>Script</strong>         See Below   See Below       See Below</p><hr><p><strong>StopMySQL Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop mysqld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>StopWebServer Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop php-fpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>StopHAProxy Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop haproxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once complete, your <strong>Workspace</strong> should look like this:</p><p><img loading="lazy" src="/ncm301/assets/images/upgrade1-ae4c3a6751451b3a2e3238c38714377f.png" width="1224" height="611" class="img_ev3q"></p><p>Similar to both scaling and initial deployment operations, we do not
want to get into a situation where the WebServer goes down before
the HAProxy, nor do we want the MySQL database to go down before the
WebServers.</p></li><li><p>Create edges between services such that HAProxy stops before
WebServers, and all WebServers stop before MySQL:</p><p><img loading="lazy" src="/ncm301/assets/images/upgrade2-9cfa88a933b158963837cf356c0eadd4.png" width="798" height="486" class="img_ev3q"></p><p>Now that our critical services are stopped, we\&#x27;ll want to perform
our updates.</p></li><li><p>Again, <strong>within each</strong> Service, add a new Task. All of the 3 tasks
are identical other than the name:</p><hr><p>  <strong>Service Name</strong>   MySQL          WebServer          HAProxy</p><p>  <strong>Task Name</strong>      UpgradeMySQL   UpgradeWebServer   UpgradeHAProxy</p><p>  <strong>Type</strong>           Execute        Execute            Execute</p><p>  <strong>Script Type</strong>    Shell          Shell              Shell</p><p>  <strong>Credential</strong>     CENTOS         CENTOS             CENTOS</p><p>  <strong>Script</strong>         See Below      See Below          See Below</p><hr><p><strong>Script for all 3 Upgrade Tasks:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum update -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This script will use the Red Hat/CentOS package management tool,
<a href="https://access.redhat.com/solutions/9934" target="_blank" rel="noopener noreferrer">yum</a> to search for and
install updates to all installed packages.</p><p>Your <strong>Workspace</strong> should now look like this:</p><p><img loading="lazy" src="/ncm301/assets/images/upgrade3-b87175489b8ccb39ed51c240b8b33421.png" width="830" height="502" class="img_ev3q"></p><p>From an a task ordering perspective, do we need to draw any
orchestration edges? Notice in the screenshot above that Calm
automatically draws and edge from the <strong>Stop</strong> task to the
<strong>Upgrade</strong> task, which is good as that\&#x27;s required. However, do we
need any side to side dependencies?</p><p>If you said \&quot;no\&quot;, you\&#x27;re correct. The critical components are
starting and stopping of the Services, there\&#x27;s no reason to have
each Service upgrade one at a time.</p><p>Unless you specify otherwise, Calm will always run tasks in parallel
to save time.</p><p>Now that our Services have been upgraded, it\&#x27;s time to start them.</p></li><li><p>Again, we\&#x27;ll add a Task <strong>within each</strong> Service, with the following
values:</p><hr><p>  <strong>Service Name</strong>   MySQL          WebServer          HAProxy</p><p>  <strong>Task Name</strong>      StartMySQL     StartWebServer     StartHAProxy</p><p>  <strong>Type</strong>           Execute        Execute            Execute</p><p>  <strong>Script Type</strong>    Shell          Shell              Shell</p><p>  <strong>Credential</strong>     CENTOS         CENTOS             CENTOS</p><p>  <strong>Script</strong>         See Below      See Below          See Below</p><hr><p><strong>StartMySQL Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start mysqld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>StartWebServer Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start php-fpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>StartHAProxy Script:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -ex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start haproxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Your <strong>Workspace</strong> should now look like this:</p><p><img loading="lazy" src="/ncm301/assets/images/upgrade4-6eebc4ba58595c8fce8e8fab041ba523.png" width="839" height="538" class="img_ev3q"></p><p>This time, we <strong>DO</strong> require additional orchestration edges. As
previously discussed, we would not want our HAProxy service up
before our WebServers, or our WebServers up before our MySQL
database.</p></li><li><p>Create orchestration edges starting with MySQL, then the WebServers,
and lastly the HAProxy:</p><p><img loading="lazy" src="/ncm301/assets/images/upgrade5-c2eae6b6911df21b7ee1067fb6d7aa9a.png" width="815" height="564" class="img_ev3q"></p></li><li><p>Click <strong>Save</strong> and ensure no errors or warnings pop-up. If they do,
resolve the issue, and <strong>Save</strong> again.</p></li></ol><h1>Launching and Managing the Application</h1><ol><li><p>From the upper toolbar in the Blueprint Editor, click <strong>Launch</strong>.</p></li><li><p>Specify a unique <strong>Application Name</strong> (e.g.
<em>Initials</em>-CalmLinuxIntro1) and your <strong>User_initials</strong> Runtime
variable value for VM naming.</p></li><li><p>Click <strong>Create</strong>.</p></li><li><p>Once the application reaches a <strong>Running</strong> status, navigate to the
<strong>Manage</strong> tab, and run the <strong>Scale Out</strong> action.</p><p>Changes to the application can be monitored on the <strong>Audit</strong> tab.</p><p>Once the scaling operation has completed, you can log into the
HAProxy VM and verify the new Web Server has been added to
<code>/etc/haproxy/haproxy.cfg</code>.</p></li><li><p>Run the <strong>Upgrade</strong> action to update each service.</p></li><li><p>Finally, run the <strong>Scale In</strong> action to remove the additional Web
Server VM.</p></li></ol><h1>(Optional) Variable Scaling</h1><p>In this lab you configured scaling operations that expanded or shrank
the WebServer service array by a single VM.</p><p>When creating a new custom action, additional variables can be defined
in the Configuration Pane specific to that action.</p><p><img loading="lazy" src="/ncm301/assets/images/optional1-cc0062ef6b33b093d86cf3aef30724cf.png" width="271" height="413" class="img_ev3q"></p><p>Leveraging a runtime variable, can you modify the scale out or scale in
actions to perform a variable scaling operation?</p><p>This will require some bash scripting experience to ensure the
appropriate number of entries are being added and/or removed from the
haproxy.cfg file.</p><h1>Takeaways</h1><p>What are the key things you should know about <strong>Nutanix Calm</strong>?</p><ul><li>Not only can Calm orchestrate complex application deployments, it
can manage applications throughout their entire lifecycle, by
modeling complex Day 2 operations.</li><li>Whether it\&#x27;s a built in task, like scaling, or a custom task, like
upgrades, Calm can be directed to perform the operations in specific
order, or if order doesn\&#x27;t matter, perform them in parallel to save
on time.</li><li>What operation are you currently doing on a regular basis? It\&#x27;s
likely that it can be modeled in Calm, saving you countless hours.
Take back your weekend!</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mat0606/ncm301/edit/main/docs/calm_windows_track/calm_day2_windows/calm_day2_windows.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Calm Automation Bootcamp. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ncm301/assets/js/runtime~main.78c31634.js"></script>
<script src="/ncm301/assets/js/main.2f042511.js"></script>
</body>
</html>